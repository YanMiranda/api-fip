SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- CRIA TABELA DE MARCAS
CREATE TABLE MARCAS (
                        MA_ID      NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                        MA_CODIGO  VARCHAR2(20 CHAR) NOT NULL,
                        MA_NOME    VARCHAR2(100 CHAR) NOT NULL,
                        CONSTRAINT PK_MARCAS PRIMARY KEY (MA_ID)
);

CREATE INDEX IX_MARCAS_CODIGO ON MARCAS (MA_CODIGO);
CREATE INDEX IX_MARCAS_NOME ON MARCAS (MA_NOME);

COMMENT ON TABLE MARCAS IS 'Marcas de veículos';
COMMENT ON COLUMN MARCAS.MA_ID IS 'Identificador da marca';
COMMENT ON COLUMN MARCAS.MA_CODIGO IS 'Código da marca';
COMMENT ON COLUMN MARCAS.MA_NOME IS 'Nome da marca';

-- CRIA TABELA DE MODELOS
CREATE TABLE MODELOS (
                         MO_ID       NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                         MA_ID       NUMBER(19) NOT NULL,
                         MO_CODIGO   VARCHAR2(20 CHAR) NOT NULL,
                         MO_NOME     VARCHAR2(150 CHAR) NOT NULL,
                         CONSTRAINT PK_MODELOS PRIMARY KEY (MO_ID),
                         CONSTRAINT FK_MODELOS_MARCAS
                             FOREIGN KEY (MA_ID) REFERENCES MARCAS (MA_ID)
);

CREATE INDEX IX_MODELOS_MA ON MODELOS (MA_ID);
CREATE INDEX IX_MODELOS_CODIGO ON MODELOS (MO_CODIGO);

COMMENT ON TABLE MODELOS IS 'Modelos de veículos';
COMMENT ON COLUMN MODELOS.MO_ID IS 'Identificador do modelo';
COMMENT ON COLUMN MODELOS.MA_ID IS 'FK para MARCAS.MA_ID';
COMMENT ON COLUMN MODELOS.MO_CODIGO IS 'Código do modelo';
COMMENT ON COLUMN MODELOS.MO_NOME IS 'Nome do modelo';

-- CRIA TABELA DE ANOS_MODELO
CREATE TABLE ANOS_MODELO (
                             AM_ID      NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                             MO_ID      NUMBER(19) NOT NULL,
                             AM_CODIGO  VARCHAR2(20 CHAR) NOT NULL,
                             AM_NOME    VARCHAR2(100 CHAR) NOT NULL,
                             CONSTRAINT PK_ANOS_MODELO PRIMARY KEY (AM_ID),
                             CONSTRAINT FK_ANOS_MODELO_MODELOS
                                 FOREIGN KEY (MO_ID) REFERENCES MODELOS (MO_ID)
);

CREATE INDEX IX_ANOS_MODELO_MO ON ANOS_MODELO (MO_ID);
CREATE INDEX IX_ANOS_MODELO_CODIGO ON ANOS_MODELO (AM_CODIGO);

COMMENT ON TABLE ANOS_MODELO IS 'Anos por modelo de veículo';
COMMENT ON COLUMN ANOS_MODELO.AM_ID IS 'Identificador do ano/modelo';
COMMENT ON COLUMN ANOS_MODELO.MO_ID IS 'FK para MODELOS.MO_ID';
COMMENT ON COLUMN ANOS_MODELO.AM_CODIGO IS 'Código do ano/modelo';
COMMENT ON COLUMN ANOS_MODELO.AM_NOME IS 'Nome do ano/modelo';

-- CRIA TABELA DE VEICULOS
CREATE TABLE VEICULOS (
                          VE_ID                NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                          AM_ID                NUMBER(19) NOT NULL,
                          VE_TIPO_VEICULO      NUMBER(10) NOT NULL,
                          VE_VALOR             VARCHAR2(50 CHAR) NOT NULL,
                          VE_MARCA             VARCHAR2(100 CHAR) NOT NULL,
                          VE_MODELO            VARCHAR2(150 CHAR) NOT NULL,
                          VE_ANO               NUMBER(10) NOT NULL,
                          VE_COMBUSTIVEL       VARCHAR2(50 CHAR),
                          VE_CODIGO_FIPE       VARCHAR2(20 CHAR),
                          VE_MES_REFERENCIA    VARCHAR2(50 CHAR),
                          VE_SIGLA_COMBUSTIVEL VARCHAR2(5 CHAR),
                          CONSTRAINT PK_VEICULOS PRIMARY KEY (VE_ID),
                          CONSTRAINT FK_VEICULOS_AM
                              FOREIGN KEY (AM_ID) REFERENCES ANOS_MODELO (AM_ID)
);

CREATE INDEX IX_VEICULOS_AM ON VEICULOS (AM_ID);
CREATE INDEX IX_VEICULOS_COD_FIPE ON VEICULOS (VE_CODIGO_FIPE);

COMMENT ON TABLE VEICULOS IS 'Cadastro de veículos';
COMMENT ON COLUMN VEICULOS.VE_ID IS 'Identificador do veículo';
COMMENT ON COLUMN VEICULOS.AM_ID IS 'FK para ANOS_MODELO.AM_ID';
COMMENT ON COLUMN VEICULOS.VE_TIPO_VEICULO IS 'Tipo do veículo (ex.: 1=carro, 2=moto, etc.)';
COMMENT ON COLUMN VEICULOS.VE_VALOR IS 'Valor conforme tabela de referência';
COMMENT ON COLUMN VEICULOS.VE_MARCA IS 'Nome da marca (denormalizado para histórico)';
COMMENT ON COLUMN VEICULOS.VE_MODELO IS 'Nome do modelo (denormalizado para histórico)';
COMMENT ON COLUMN VEICULOS.VE_ANO IS 'Ano do veículo';
COMMENT ON COLUMN VEICULOS.VE_COMBUSTIVEL IS 'Tipo de combustível';
COMMENT ON COLUMN VEICULOS.VE_CODIGO_FIPE IS 'Código FIPE';
COMMENT ON COLUMN VEICULOS.VE_MES_REFERENCIA IS 'Mês de referência da tabela';
COMMENT ON COLUMN VEICULOS.VE_SIGLA_COMBUSTIVEL IS 'Sigla do combustível';

COMMIT;